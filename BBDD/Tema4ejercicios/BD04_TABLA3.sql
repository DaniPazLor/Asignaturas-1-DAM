/* tabla empleados */
CREATE TABLE EMPLEADOS ( 
DNI INT, 
NOMBRE VARCHAR(10) NOT NULL, 
APELLIDO1 VARCHAR(15) NOT NULL, 
APELLIDO2 VARCHAR(15), 
SALARIO DECIMAL(10,2), /* podría ganar mucho */ 
DIRECC1 VARCHAR(25), 
DIRECC2 VARCHAR(20), 
CIUDAD VARCHAR(20), 
MUNICIPIO VARCHAR(20), 
COD_POSTAL VARCHAR(5), 
SEXO CHAR(1), 
FECHA_NAC DATE, 
CONSTRAINT PK_EMPLEADOS PRIMARY KEY (DNI), 
CONSTRAINT CK_SEXO CHECK (SEXO IN ('H', 'M')) );

/* Tabla universidades */
CREATE TABLE UNIVERSIDADES (
UNIV_COD INT,
NOMBRE_UNIV VARCHAR(25) NOT NULL,
CIUDAD VARCHAR(20),
MUNICIPIO VARCHAR(20),
COD_POSTAL VARCHAR(5),
CONSTRAINT PK_UNIVERSIDADES PRIMARY KEY (UNIV_COD)
);

/* tabla departamentos */


CREATE TABLE DEPARTAMENTOS (
DPTO_COD INT,
JEFE INT,
NOMBRE_DPTO VARCHAR(30) NOT NULL,
PRESUPUESTO INT NOT NULL,
PRES_ACTUAL INT,
CONSTRAINT PK_DEPARTAMENTOS PRIMARY KEY (DPTO_COD),
CONSTRAINT FK_DEPARTAMENTOS FOREIGN KEY (JEFE) REFERENCES EMPLEADOS (DNI)
);


/* tabla trabajos */
CREATE TABLE TRABAJOS (
TRABAJO_COD INT,
NOMBRE_TRAB VARCHAR(20) NOT NULL UNIQUE,
SALARIO_MIN INT NOT NULL,
SALARIO_MAX INT NOT NULL,
CONSTRAINT PK_TRABAJOS PRIMARY KEY (TRABAJO_COD)
);

/* tabla estudios */
CREATE TABLE ESTUDIOS (
EMPLEADO_DNI INT,
UNIVERSIDAD INT,
AÑO INT,
GRADO VARCHAR(5),
ESPECIALIDAD VARCHAR(20),
CONSTRAINT PK_ESTUDIOS PRIMARY KEY (EMPLEADO_DNI, AÑO, GRADO),
CONSTRAINT FK_ESTUDIOS_EMPLEADOS FOREIGN KEY (EMPLEADO_DNI) REFERENCES EMPLEADOS (DNI),
CONSTRAINT FK_ESTUDIOS_UNIVERSIDADES FOREIGN KEY (UNIVERSIDAD) REFERENCES UNIVERSIDADES (UNIV_COD)
);

/* tabla historial_laboral */
CREATE TABLE HISTORIAL_LABORAL (
EMPLEADO_DNI INT,
TRAB_COD INT,
FECHA_INICIO DATE,
FECHA_FIN DATE,
DPTO_COD INT,
SUPERVISOR_DNI INT,
CONSTRAINT PK_HISTORIAL_LABORAL PRIMARY KEY (EMPLEADO_DNI, FECHA_INICIO),
CONSTRAINT FK_HLABORAL_EMPLEADOS FOREIGN KEY (EMPLEADO_DNI) REFERENCES EMPLEADOS (DNI),
CONSTRAINT FK_HLABORAL_TRABAJOS FOREIGN KEY (TRAB_COD) REFERENCES TRABAJOS (TRABAJO_COD),
CONSTRAINT FK_HLABORAL_DEPARTAMENTOS FOREIGN KEY (DPTO_COD) REFERENCES DEPARTAMENTOS (DPTO_COD),
CONSTRAINT FK_HLABORAL_SUPERVISOR FOREIGN KEY (SUPERVISOR_DNI) REFERENCES EMPLEADOS (DNI),
CONSTRAINT CK_HLABORAL_FECHAS CHECK (FECHA_FIN IS NULL OR FECHA_INICIO < FECHA_FIN)
);
/* tabla historial_salarial */
CREATE TABLE HISTORIAL_SALARIAL (
EMPLEADO_DNI INT,
SALARIO INT,
FECHA_COMIENZO DATE,
FECHA_FIN DATE,
CONSTRAINT PK_HISTORIAL_SALARIAL PRIMARY KEY (EMPLEADO_DNI, FECHA_COMIENZO),
CONSTRAINT FK_HISTORIAL_SALARIAL FOREIGN KEY (EMPLEADO_DNI) REFERENCES EMPLEADOS (DNI),
CONSTRAINT CK_FECHAS CHECK (FECHA_FIN IS NULL OR FECHA_COMIENZO < FECHA_FIN)
); 

ALTER SESSION SET NLS_DATE_FORMAT='DD/MM/YYYY';
/* EMPLEADOS */
INSERT INTO EMPLEADOS VALUES( '12345','Jose', 'Mercé','López', '1500','C/Sol, 1', 'C/ Otra, 1', 'Cádiz','Cádiz', '11000', 'H', '5/01/74');
INSERT INTO EMPLEADOS VALUES( '22222','María', 'Rosal','Cózar','2000', '', '', 'Ubrique','Cádiz', '11600', 'M', '');
INSERT INTO EMPLEADOS VALUES( '33333','Pilar', 'Pérez','Rollán','1000', '', '', 'Cádiz','', '11600', 'M', '2/8/73');

/* DEPARTAMENTOS  */
INSERT INTO DEPARTAMENTOS VALUES( '001', 'INFORMÁTICA', '33333', 80000, 50000);

/* UNIVERSIDADES  */
INSERT INTO UNIVERSIDADES VALUES('0001', 'UNED', 'MADRID', 'M', '41420');
INSERT INTO UNIVERSIDADES VALUES('0002', 'SEVILLA', 'SEVILLA', '', '55555');
INSERT INTO UNIVERSIDADES VALUES('0003', 'CÁDIZ', 'CÁDIZ', '', '11000');

/* TRABAJOS  */
INSERT INTO TRABAJOS VALUES ('001', 'ADMINISTRATIVO', 900, 1000);
INSERT INTO TRABAJOS VALUES ('002', 'CONTABLE', 900, 1000);
INSERT INTO TRABAJOS VALUES ('003', 'INGENIERO TÉCNICO', 1000, 1200);
INSERT INTO TRABAJOS VALUES ('004', 'INGENIERO', 1200, 1800);

/* ESTUDIOS */
INSERT INTO ESTUDIOS VALUES( '12345', '0001', '1992', 'MED', 'ADMINISTRATIVO');
INSERT INTO ESTUDIOS VALUES( '22222', '0001', '1998', 'SUP', 'ING INFORMÁTICA');
INSERT INTO ESTUDIOS VALUES( '33333', '0002', '1997', 'SUP', 'LIC INFORMÁTICA');

/* HISTORIAL SALARIAL  */
INSERT INTO HISTORIAL_SALARIAL VALUES( '12345', 950, '2003/01/05', '');
INSERT INTO HISTORIAL_SALARIAL VALUES( '22222', 1000, '2004/11/03', '2005/11/03');
INSERT INTO HISTORIAL_SALARIAL VALUES( '22222', 1500, '2005/11/03', '');
INSERT INTO HISTORIAL_SALARIAL VALUES( '33333',1600, '2001/01/15', '');

/* HISTORIAL LABORAL */
INSERT INTO HISTORIAL_LABORAL VALUES( '12345', '001', '2003/01/05','', '0001', '33333');
INSERT INTO HISTORIAL_LABORAL VALUES( '22222', '003', '2004/11/05', '2005/11/03', '001', '33333');
INSERT INTO HISTORIAL_LABORAL VALUES( '22222', '003', '2005/01/03', '', '001', '33333');
INSERT INTO HISTORIAL_LABORAL VALUES( '33333','004', '2001/01/15', '', '001', '33333');
